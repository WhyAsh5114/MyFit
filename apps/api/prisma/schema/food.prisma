model MacroTargets {
  id                  String                @id @default(uuid())
  createdAt           DateTime              @default(now())
  proteinG            Float?
  carbsG              Float?
  fatG                Float?
  quantifier          MacroTargetQuantifier
  weeklyCaloricChange Int

  user   User   @relation(fields: [userId], references: [id])
  userId String
}

model MacroMetrics {
  id                String     @id @default(uuid())
  createdAt         DateTime   @default(now())
  bodyweight        Float
  bodyweightUnit    WeightUnit
  height            Float
  heightUnit        HeightUnit
  bodyFatPercentage Float
  age               Int
  gender            Gender

  user   User   @relation(fields: [userId], references: [id])
  userId String
}

model MacroActivityTrackingPreferences {
  id             String                 @id @default(uuid())
  userId         String                 @unique
  adjustmentType ActivityAdjustmentType
  staticCalories Int?
  user           User                   @relation(fields: [userId], references: [id])
}

model FoodEntry {
  id        String   @id @default(uuid())
  eatenAt   DateTime
  quantityG Float

  productName   String
  brands        String?
  preferredUnit PreferrredFoodEntryUnit
  meal          String?

  // Serving size metadata
  servingQuantity Float?
  servingSize     String?

  // Required 100g macros
  energyKcal_100g     Float
  proteinsG_100g      Float
  fatG_100g           Float
  carbohydratesG_100g Float

  // Optional 100g micronutrients
  saturatedFatG_100g       Float?
  unsaturatedFatG_100g     Float?
  monounsaturatedFatG_100g Float?
  polyunsaturatedFatG_100g Float?
  transFatG_100g           Float?
  cholesterolMg_100g       Float?
  sugarsG_100g             Float?
  polyolsG_100g            Float?
  fiberG_100g              Float?
  saltG_100g               Float?
  sodiumMg_100g            Float?
  alcoholG_100g            Float?
  vitaminAIU_100g          Float?
  vitaminDIU_100g          Float?
  vitaminEMg_100g          Float?
  vitaminKMcg_100g         Float?
  vitaminCMg_100g          Float?
  vitaminB1Mg_100g         Float?
  vitaminB2Mg_100g         Float?
  vitaminB6Mg_100g         Float?
  vitaminB9Mcg_100g        Float?
  folatesMcg_100g          Float?
  vitaminB12Mcg_100g       Float?
  potassiumMg_100g         Float?
  calciumMg_100g           Float?
  phosphorusMg_100g        Float?
  ironMg_100g              Float?
  magnesiumMg_100g         Float?
  zincMg_100g              Float?
  copperMg_100g            Float?
  manganeseMg_100g         Float?
  caffeineMg_100g          Float?

  user   User   @relation(fields: [userId], references: [id])
  userId String
}

model ActivityEntry {
  id              String   @id @default(uuid())
  performedAt     DateTime
  calories        Int
  quantity        Int
  quantityUnit    String
  systemGenerated Boolean  @default(false)

  user   User   @relation(fields: [userId], references: [id])
  userId String
}

model NutritionData {
  id           String                  @id @default(uuid())
  code         String
  productName  String
  brands       String?
  searchVector Unsupported("tsvector")

  // Serving size metadata
  servingQuantity Float?
  servingSize     String?

  // Required 100g macros
  energyKcal_100g     Float
  proteinsG_100g      Float
  fatG_100g           Float
  carbohydratesG_100g Float

  // Optional 100g micronutrients
  saturatedFatG_100g       Float?
  unsaturatedFatG_100g     Float?
  monounsaturatedFatG_100g Float?
  polyunsaturatedFatG_100g Float?
  transFatG_100g           Float?
  cholesterolMg_100g       Float?
  sugarsG_100g             Float?
  polyolsG_100g            Float?
  fiberG_100g              Float?
  saltG_100g               Float?
  sodiumMg_100g            Float?
  alcoholG_100g            Float?
  vitaminAIU_100g          Float?
  vitaminDIU_100g          Float?
  vitaminEMg_100g          Float?
  vitaminKMcg_100g         Float?
  vitaminCMg_100g          Float?
  vitaminB1Mg_100g         Float?
  vitaminB2Mg_100g         Float?
  vitaminB6Mg_100g         Float?
  vitaminB9Mcg_100g        Float?
  folatesMcg_100g          Float?
  vitaminB12Mcg_100g       Float?
  potassiumMg_100g         Float?
  calciumMg_100g           Float?
  phosphorusMg_100g        Float?
  ironMg_100g              Float?
  magnesiumMg_100g         Float?
  zincMg_100g              Float?
  copperMg_100g            Float?
  manganeseMg_100g         Float?
  caffeineMg_100g          Float?

  @@index([code])
  @@index([brands(ops: raw("gin_trgm_ops"))], map: "nutrition_brands_trgm_idx", type: Gin)
  @@index([productName(ops: raw("gin_trgm_ops"))], map: "nutrition_product_name_trgm_idx", type: Gin)
  @@index([searchVector], map: "nutrition_search_vector_idx", type: Gin)
}

enum MacroTargetQuantifier {
  Percentage
  Absolute
}

enum Gender {
  Male
  Female
}

enum WeightUnit {
  kg
  lb
}

enum HeightUnit {
  cm
  in
}

enum ActivityAdjustmentType {
  Static
  Dynamic
  Manual
}

enum PreferrredFoodEntryUnit {
  g
  serving
}
